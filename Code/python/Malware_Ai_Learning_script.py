import os
import json

based_dir = os.path.abspath(os.path.dirname(__file__))
target_dir = os.path.join(based_dir, "learn")
decoded_target_dir = os.path.join(based_dir, "decoded")
file_list = os.listdir(target_dir)

out = open(os.path.join(based_dir, "result.txt"), "w")

diec_path = os.path.join(based_dir, "die") + os.sep
snowman_path = os.path.join(based_dir, "snowman") + os.sep

for files in file_list:
    # 파일의 절대경로 출력
    now_path = os.path.join(target_dir, files)
    now_path = os.path.abspath(now_path)
    diec = json.loads(
        os.popen(diec_path + "diec -rduj " + now_path).read())
    rabin2 = json.loads(
        os.popen("rabin2 -i -I -l -S -j " + now_path).read())
    decoded = os.popen(snowman_path + "nocode " + now_path).read()
    out.write(files + "\n")
    out.write(str(diec) + "\n")
    out.write(str(rabin2) + "\n")
    decoded_out = open(os.path.join(decoded_target_dir, files + ".cc"), "w")
    decoded_out.write(decoded)
    decoded_out.close()

out.close()
